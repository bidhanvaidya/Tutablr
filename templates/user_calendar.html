<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta name="generator" content="HTML Tidy for Windows (vers 14 February 2006), see www.w3.org" />
	<link rel='stylesheet' type='text/css' href='{{STATIC_URL}}fullcalendar/jquery-ui-1.9.0.custom.css' />
    <link rel='stylesheet' type='text/css' href='{{STATIC_URL}}fullcalendar/fullcalendar.css' />
    <link rel='stylesheet' type='text/css' href='{{STATIC_URL}}fullcalendar/fullcalendar.print.css' media='print' />
	<script type="text/javascript" src="{{STATIC_URL}}fullcalendar/jquery-1.8.2.js"></script>
    <script type='text/javascript' src='{{STATIC_URL}}fullcalendar/jquery-ui-1.9.0.custom.js'></script>
    <script type='text/javascript' src='{{STATIC_URL}}fullcalendar/fullcalendar.min.js'></script>
	
    <script type='text/javascript'>
//<![CDATA[
function isOverlapping(event){
    var array = calendar.fullCalendar('clientEvents');
    for(i in array){
        if(array[i].id != event.id){
            if(!(array[i].start >= event.end || array[i].end <= event.start)){
                return true;
            }
        }
    }
    return false;
}
$(document).ready(function() {
	var last_url = location.pathname.match(/\/user\/(.*)/)[1]
	var user_id = '';
	if(last_url[last_url.length-1] == '/'){
		user_id = last_url.substring(0, last_url.length-1);
	}else{
		user_id = last_url;
	}

	$('#calendar').fullCalendar({
		header: {
				left: 'prev,next today',
				center: 'title',
				right: 'month,agendaWeek,agendaDay'
		},
		defaultView: 'agendaWeek',
		selectable: true,
		selectHelper: true,
		editable: true,
		disableResizing: true,
		eventDrop: function(event, dayDelta, minuteDelta, allDay, revertFunc) {
			if (isOverlapping(event)) {revertFunc()};
		},
		select: function(start, end, allDay) {
			if(selectable){
				var start = $.fullCalendar.formatDate(start, "yyyy-MM-dd HH:mm");
				var end = $.fullCalendar.formatDate(end, "yyyy-MM-dd HH:mm");
				$("#add_start").val(start);   //this just populates the value into my dialog form
				$("#add_end").val(end);
				$("#add_event" ).dialog( "open" );
				calendar.fullCalendar('unselect');
			}
		   },
		   eventClick: function(event, jsEvent, view){
				if(event.editable){
					var start = $.fullCalendar.formatDate(event.start, "yyyy-MM-dd HH:mm");
					var end = $.fullCalendar.formatDate(event.end, "yyyy-MM-dd HH:mm");
					var id = event.id;
					var title = event.title;
					$("#edit_start").val(start);
					$("#edit_end").val(end);
					$("#edit_title").val(title);
					$("#edit_event_id").val(id);
					$("#edit_event" ).dialog( "open" );
				}
		   },
		events: '../user_events.json/' + user_id
	});
	// jQuery UI Dialog
	$('#edit_event').dialog({
			autoOpen: false,
			width: 400,
			height: 300,
			modal: true,
			resizable: true,
			buttons: {
					"Yes": function() {
							$(this).dialog("close");
							$(location).attr('href',$(this).dialog('option', 'anchor'));
							return true;
					},
					"No": function() {
							$(this).dialog("close");
							return false;
					}
			}
	});
	$('#add_event').dialog({
                autoOpen: false,
                width: 400,
				height: 300,
                modal: true,
                resizable: true,
                buttons: {
                        "Yes": function() {
                                $(this).dialog("close");
                                $(location).attr('href',$(this).dialog('option', 'anchor'));
                                return true;
                        },
                        "No": function() {
                                $(this).dialog("close");
                                return false;
                        }
                }
        });
});
    //]]>
    </script>
    <style type='text/css'>
/*<![CDATA[*/

    body {
        margin-top: 40px;
        text-align: center;
        font-size: 14px;
        font-family: "Lucida Grande",Helvetica,Arial,Verdana,sans-serif;
    }

    #calendar {
    width: 900px;
    margin: 0 auto;
    }

    /*]]>*/
    </style>
    <title></title>
  </head>
  <body>
    <div id="edit_event" title="Edit Event">
      <form action="">
        <fieldset>
          <label for="edit_start">Start</label> <input type="text" name=
          "edit_start" id="edit_start" class=
          "text ui-widget-content ui-corner-all" /> <br>
		  <label for="edit_end">End</label> <input type="text" name="edit_end" id=
          "edit_end" class="text ui-widget-content ui-corner-all" /><br>
          <label for="title">Event Description</label> <input type="text" name=
          "edit_title" id="edit_title" class=
          "text ui-widget-content ui-corner-all" /> <input type="hidden" name=
          "edit_event_id" id="edit_event_id" class=
          "text ui-widget-content ui-corner-all" />
        </fieldset>
      </form>
    </div>
	<div id="add_event" title="Add Event">
      <form action="">
        <fieldset>
		  <label for="event type">Event Type</label> <input type="text" name="add_type" id="add_type" class="text ui-widget-content ui-corner-all" /><br>
          <label for="edit_start">Start</label> <input type="text" name="add_start" id="add_start" class="text ui-widget-content ui-corner-all" /> <br>
		  <label for="add_end">End</label> <input type="text" name="add_end" id="add_end" class="text ui-widget-content ui-corner-all" /><br>
          <label for="add_title">Event Description</label> <input type="text" name="add_title" id="add_title" class="text ui-widget-content ui-corner-all" /> 
		  <input type="hidden" name="addevent_id" id="add_event_id" class="text ui-widget-content ui-corner-all" />
        </fieldset>
      </form>
    </div>
    <div id='calendar'></div>
  </body>
</html>
