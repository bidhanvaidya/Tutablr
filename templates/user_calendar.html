<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta name="generator" content="HTML Tidy for Windows (vers 14 February 2006), see www.w3.org" />
	<link rel='stylesheet' type='text/css' href='{{STATIC_URL}}fullcalendar/jquery-ui-1.9.0.custom.css' />
    <link rel='stylesheet' type='text/css' href='{{STATIC_URL}}fullcalendar/fullcalendar.css' />
    <link rel='stylesheet' type='text/css' href='{{STATIC_URL}}fullcalendar/fullcalendar.print.css' media='print' />
	<script type="text/javascript" src="{{STATIC_URL}}fullcalendar/jquery-1.8.2.js"></script>
    <script type='text/javascript' src='{{STATIC_URL}}fullcalendar/jquery-ui-1.9.0.custom.js'></script>
    <script type='text/javascript' src='{{STATIC_URL}}fullcalendar/fullcalendar.min.js'></script>
	
    <script type='text/javascript'>
//<![CDATA[
function isOverlapping(event){
    var array = calendar.fullCalendar('clientEvents');
    for(i in array){
        if(array[i].id != event.id){
            if(!(array[i].start >= event.end || array[i].end <= event.start)){
                return true;
            }
        }
    }
    return false;
}
$(document).ready(function() {
	var last_url = location.pathname.match(/\/user\/(.*)/)[1]
	var user_id = '';
	if(last_url[last_url.length-1] == '/'){
		user_id = last_url.substring(0, last_url.length-1);
	}else{
		user_id = last_url;
	}
	$('#calendar').fullCalendar({
		header: {
			left: 'prev,next today',
			center: 'title',
			right: 'month,agendaWeek,agendaDay'
		},
		defaultView: 'agendaWeek',
		selectable: true,
		selectHelper: true,
		editable: true,
		disableResizing: true,
		aspectRatio: 1.75,
		eventDrop: function(event, dayDelta, minuteDelta, allDay, revertFunc) {
			if (!event.editable) {
				revertFunc();
			}else{
				var start_time = $.fullCalendar.formatDate(event.start, "HH:mm");
				var end_time = $.fullCalendar.formatDate(event.end, "HH:mm");
				var start_date = $.fullCalendar.formatDate(event.start, "dd/MM/yyyy");
				var end_date = $.fullCalendar.formatDate(event.end, "dd/MM/yyyy");
				var id = event.id;
				var title = event.title;
				$("#edit_start").val(start_time);
				$("#edit_end").val(end_time);
				$("#edit_title").val(title);
				$("#edit_event_id").val(id);
				$('#datePicker_start_edit').attr("disabled", false);
				$('#datePicker_start_edit').val(start_date);
				$("#edit_booking" ).dialog( "open" );
			}	
		},
		select: function(start, end, allDay) {
				var start_time = $.fullCalendar.formatDate(start, "HH:mm");
				var end_time = $.fullCalendar.formatDate(end, "HH:mm");
				var start_date = $.fullCalendar.formatDate(start, "dd/MM/yyyy");
				var end_date = $.fullCalendar.formatDate(end, "dd/MM/yyyy");
				$('#add_booking').dialog('option', 'title', 'Edit Booking');
				$("#id_start_time").val(start_time);
				$("#id_finish_time").val(end_time);
				$("#add_booking" ).dialog( "open" );
				$('#id_date').attr("disabled", false);
				$('#id_date').val(start_date);
				calendar.fullCalendar('unselect');
		   },
		   eventClick: function(event, jsEvent, view){
				if(event.editable){
					var start_time = $.fullCalendar.formatDate(event.start, "HH:mm");
					var end_time = $.fullCalendar.formatDate(event.end, "HH:mm");
					var start_date = $.fullCalendar.formatDate(event.start, "dd/MM/yyyy");
					var end_date = $.fullCalendar.formatDate(event.end, "dd/MM/yyyy");
					var id = event.id;
					var title = event.title;
					if(event.type == "tutor_session" || event.type == "student_session"){
						$("#edit_session_start").val(start_time);
						$("#edit_session_end").val(end_time);
						$("#edit_session_title").val(title);
						$("#edit_session_event_id").val(id);
						$('#datePicker_session_start_edit').attr("disabled", false);
						$('#datePicker_session_start_edit').val(start_date);
						if(event.type == "tutor_session"){
							$('#edit_session').dialog('option', 'title', 'Edit Tutor Session');
							$("#btnSessionDelete").button("enable");
						}else{
							$('#edit_session').dialog('option', 'title', 'Edit Student Session');
							$("#btnSessionDelete").button("disable");
						}
						$("#edit_session" ).dialog( "open" );
					}else if(event.type == "tutor_booking" || event.type == "student_booking"){
						$("#edit_start").val(start_time);
						$("#edit_end").val(end_time);
						$("#edit_title").val(title);
						$("#edit_event_id").val(id);
						$('#datePicker_start_edit').attr("disabled", false);
						$('#datePicker_start_edit').val(start_date);
						if(event.type == "tutor_booking"){
							$('#edit_booking').dialog('option', 'title', 'Edit Tutor Booking');
							$("#btnDelete").button("enable");
						}else{
							$('#edit_booking').dialog('option', 'title', 'Edit Student Booking');
							$("#btnDelete").button("disable");
						}
						$("#edit_booking" ).dialog( "open" );

					}
				}
		   },
		events: '/calendar/user_events.json/' + user_id
	});
	// jQuery UI Dialog
	$('#edit_booking').dialog({
			autoOpen: false,
			width: 400,
			height: 300,
			modal: true,
			resizable: true,
			buttons: [{
						text: "Submit",
						"id": "btnSubmit",
						click: function() {
								$(this).dialog("close");
								$(location).attr('href',$(this).dialog('option', 'anchor'));
								url = '/../../update_booking/' + user_id + '/';
								document.editBookingForm.action=url;
								$("[id*=SubmitEdit]").click();
								return true;
						},
					},
					{
						text: "Cancel",
						"id": "btnCancel",
						click: function() {
								$(this).dialog("close");
								return false;
						},
					},
					{
						text: "Reject",
						"id": "btnConfirm",
						click: function() {
								$(this).dialog("close");
								$(location).attr('href',$(this).dialog('option', 'anchor'));
								url = '/../../reject_booking/' + user_id + '/';
								document.editBookingForm.action=url;
								$("[id*=SubmitEdit]").click();
								return true;
						},
					},

					{
						text: "Confirm",
						"id": "btnConfirm",
						click: function() {
								$(this).dialog("close");
								$(location).attr('href',$(this).dialog('option', 'anchor'));
								url = '/../../confirm_booking/' + user_id + '/';
								document.editBookingForm.action=url;
								$("[id*=SubmitEdit]").click();
								return true;
						},
					},

					/*{
						text: "Delete",
						"id": "btnDelete",
						click: function() {
								$(this).dialog("close");
								$(location).attr('href',$(this).dialog('option', 'anchor'));
								url = '/../../delete_booking/' + user_id + '/';
								document.editBookingForm.action=url;
								$("[id*=SubmitEdit]").click();
								return true;
						   }
					}*/
			]
	});	
	// jQuery UI Dialog
	$('#edit_session').dialog({
			autoOpen: false,
			width: 400,
			height: 300,
			modal: true,
			resizable: true,
			buttons: [{
						text: "Submit",
						"id": "btnSessionSubmit",
						click: function() {
								$(this).dialog("close");
								$(location).attr('href',$(this).dialog('option', 'anchor'));
								url = '/../../update_session/' + user_id + '/';
								document.editSessionForm.action=url;
								$("[id*=SubmitEditSession]").click();
								return true;
						},
					},
					{
						text: "Cancel",
						"id": "btnSessionCancel",
						click: function() {
								$(this).dialog("close");
								return false;
						},
					},
					{
						text: "Delete",
						"id": "btnSessionDelete",
						click: function() {
								$(this).dialog("close");
								$(location).attr('href',$(this).dialog('option', 'anchor'));
								url = '/../../delete_session' + user_id + '/';
								document.editSessionForm.action=url;
								$("[id*=SubmitEditSession]").click();
								return true;
						   }
					}
			]
	});	
	$('#add_booking').dialog({
                autoOpen: false,
                width: 400,
				height: 300,
                modal: true,
                resizable: true,
                buttons: {
                        "Submit": function() {
                                $(this).dialog("close");
                                $(location).attr('href',$(this).dialog('option', 'anchor'));
				url = '/../../add_booking/' + user_id + '/';
				document.addBookingForm.action=url;
				$("[id*=SubmitAdd]").click();
                                return true;
                        },
                        "Cancel": function() {
                                $(this).dialog("close");
                                return false;
                        }
						
                }
        });  

	$("#datePicker_start_edit").datepicker({ dateFormat: 'dd/mm/yy' });
	$("#id_date").datepicker({ dateFormat: 'dd/mm/yy' });
	
	$('#a').click(function() {
        $('#add_booking').dialog('close');
    	$('#edit_booking').dialog('close');
	$('#edit_session').dialog('close');

	});
function myFunction()
{
alert("Hello World!");
}

});
    //]]>
    </script>
    <style type='text/css'>
/*<![CDATA[*/

    body {
        margin-top: 40px;
        text-align: center;
        font-size: 14px;
        font-family: "Lucida Grande",Helvetica,Arial,Verdana,sans-serif;
    }

    #calendar {
    width: 800px;
    margin: 0 auto;
    }

    /*]]>*/
    </style>
    <title></title>
  </head>
  <body>
    <div id="edit_booking" title="Edit Booking">
      <form name="editBookingForm" action="/../../update_booking/"  method="post">{% csrf_token %}
        <fieldset>
		    <div id="edit_div">
              	<label for = "edit_date_start"> Date </label> 
        		    <input type="text" name = "edit_start_date" id="datePicker_start_edit" required="required" /> <br>
              	<label for="edit_start">Start Time</label> 
              	    <input type="text" name="edit_start" id="edit_start" class="text ui-widget-content ui-corner-all" required="required" /> <br>
		      	<label for="edit_end">End Time</label> 
		      	    <input type="text" name="edit_end" id="edit_end" class="text ui-widget-content ui-corner-all" required="required" /><br>
              	<label for="title">Event Description</label> 
              	    <input type="text" name="edit_title" id="edit_title" class="text ui-widget-content ui-corner-all" /> 
		    </div>
		    <input type="hidden" name="edit_event_id" id="edit_event_id" class="text ui-widget-content ui-corner-all" required="required" />
        </fieldset>
         <input type="submit" value="Yes" id ="SubmitEdit" style="display:none"> 
      </form>
    </div>
 
    <div id="edit_sesson" title="Edit Session">
      <form hidden="hidden" name="editSessionForm" action="/../../update_session/"  method="post">{% csrf_token %}
        <fieldset>
	<div id="edit_session_div">
              	<label for = "edit_session_start_date"> Date </label> 
       		    <input type="text" name = "edit_session_start_date" id="datePicker_session_start_edit" required="required" /> <br>
              	<label for="edit_session_start">Start Time</label> 
             	    <input type="text" name="edit_session_start" id="edit_session_start" class="text ui-widget-content ui-corner-all" required="required" /> <br>
		      	<label for="edit_session_end">End Time</label> 
		      	    <input type="text" name="edit_session_end" id="edit_session_end" class="text ui-widget-content ui-corner-all" required="required" /><br>
              	<label for="edit_session_title">Event Description</label> 
              	    <input type="text" name="edit_session_title" id="edit_session_title" class="text ui-widget-content ui-corner-all" /> 
	</div>
		    <input type="hidden" name="edit_session_event_id" id="edit_session_event_id" class="text ui-widget-content ui-corner-all" required="required" />
        </fieldset>
         <input type="submit" value="Yes" id ="SubmitEditSession" style="display:none"> 
      </form>
    </div>

 <div id="add_booking" title="Add Booking">
    <form name="addForm" action="/../../add_booking/" method="post">{% csrf_token %}
        {{form.as_p}}
		<input class="datePicker" readonly="true" type="text" id="id_date" style="display:none" />
		<input type="submit" value="Yes" id="SubmitAdd" style="display:none"> 
    </form>
    </div>
    <div id='calendar'></div>
  </body>
</html>
